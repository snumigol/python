import csv
import falconpy
from falconpy import SpotlightVulnerabilities

#login credentials
falcon = SpotlightVulnerabilities(client_id=,
                                  client_secret=,
                                  base_url=
                                  )

#getting vulnerabilities by severity
response_medium = falcon.query_vulnerabilities_combined(filter="cve.severity:'MEDIUM'+created_timestamp:>'2000-01-01'+status:['open','reopen']")
total_medium_alerts = response_medium['body']['meta']['pagination']['total']

response_low = falcon.query_vulnerabilities_combined(filter="cve.severity:'LOW'+created_timestamp:>'2000-01-01'+status:['open','reopen']")
total_low_alerts = response_low['body']['meta']['pagination']['total']

response_high = falcon.query_vulnerabilities_combined(filter="cve.severity:'HIGH'+created_timestamp:>'2000-01-01'+status:['open','reopen']")
total_high_alerts = response_high['body']['meta']['pagination']['total']

response_critical = falcon.query_vulnerabilities_combined(filter="cve.severity:'CRITICAL'+created_timestamp:>'2000-01-01'+status:['open','reopen']")
total_critical_alerts = response_critical['body']['meta']['pagination']['total']


print("Low alerts: " + str(total_low_alerts))
print("Medium alerts: " + str(total_medium_alerts))
print("High alerts: " + str(total_high_alerts))
print("Critical alerts: " + str(total_critical_alerts))

header = ['Low alerts ', 'Medium alerts ', 'High alerts ', 'Critical alerts ']
data = [total_low_alerts, total_medium_alerts, total_high_alerts, total_critical_alerts]

#save to
with open(my_path, 'w',newline='') as f:
    writer = csv.writer(f)
    writer.writerow(header)
    writer.writerow(data)


